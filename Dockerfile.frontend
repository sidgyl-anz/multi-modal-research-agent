# Use an official Python runtime as a parent image
FROM python:3.11-slim

# Install uv (consistent with the backend Dockerfile)
RUN apt-get update && apt-get install -y curl && rm -rf /var/lib/apt/lists/*
RUN curl -LsSf https://astral.sh/uv/install.sh | sh
ENV PATH="/root/.local/bin:${PATH}"

# Set the working directory in the container
WORKDIR /app

# Copy requirements.txt and frontend.py
COPY requirements.txt ./
COPY frontend.py ./
# Note: If frontend.py had other local dependencies (e.g., image assets in another folder),
# those would need to be copied too. For now, it's self-contained with requirements.

# Install dependencies using uv
RUN uv pip install --system -r requirements.txt

# Expose the port Streamlit will run on (Cloud Run sets PORT env var)
EXPOSE 8080

# Define the command to run the Streamlit application
# Cloud Run will set the PORT environment variable.
# --server.headless true is recommended for running in a container.
# --server.enableCORS false can sometimes be useful, though might not be strictly necessary here.
# --server.address 0.0.0.0 makes it listen on all available network interfaces.
CMD ["sh", "-c", "streamlit run frontend.py --server.port ${PORT:-8501} --server.headless true --server.enableCORS false --server.address 0.0.0.0"]
